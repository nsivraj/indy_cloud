<html>
<head>
<title>Digital Identifiers</title>
<script>
  //document.getElementById('issuerStep1').addEventListener('click', issuerStep1);
  var restProtocol = 'http';
  var restHost = 'localhost';
  var restPort = 9000;
  var step1Answer = '';
  var step2Answer = '';
  var step3Answer = '';
  var step4Answer = '';
  var step5Answer = '';
  var step6Answer = '';

  async function issuerStep1() {
    const response = await fetch(
      `${restProtocol}://${restHost}:${restPort}/api/issuer/step1/0`
    )
    step1Answer = await response.json()
    console.log("issue step1 answer: ", step1Answer)
  }

  async function proverStep2() {
    const response = await fetch(
      `${restProtocol}://${restHost}:${restPort}/api/prover/step2/0`
    )
    step2Answer = await response.json()
    console.log("prover step2 answer: ", step2Answer)
  }

  async function issuerStep3() {
    const response = await fetch(
      `${restProtocol}://${restHost}:${restPort}/api/issuer/step3/${step2Answer.walletId}/${step1Answer.credDefId}`
    )
    step3Answer = await response.json()
    console.log("issuer step3 answer: ", step3Answer)
  }

  async function proverStep4() {
    const step4Body = {
      credOffer: step3Answer.credOffer,
      credDefJson: step1Answer.credDefJson
    }
    const response = await fetch(
      `${restProtocol}://${restHost}:${restPort}/api/prover/step4/${step2Answer.walletId}`, {
        method: 'POST',
        body: JSON.stringify(step4Body),
        headers: {
          'Content-Type': 'application/json'
        }
      }
    )
    step4Answer = await response.json()
    console.log("prover step4 answer: ", step4Answer)
  }

  async function issuerStep5() {
    const step5Body = {
      credOffer: step3Answer.credOffer,
      credReqJson: step4Answer.credReqJson
    }
    const response = await fetch(
      `${restProtocol}://${restHost}:${restPort}/api/issuer/step5/${step2Answer.walletId}`, {
        method: 'POST',
        body: JSON.stringify(step5Body),
        headers: {
          'Content-Type': 'application/json'
        }
      }
    )
    step5Answer = await response.json()
    console.log("prover step5 answer: ", step5Answer)
  }


  async function proverStep6() {
    const step6Body = {
      credDefJson: step1Answer.credDefJson,
      credReqMetadataJson: step4Answer.credReqMetadataJson,
      credential: step5Answer.credential
    }
    const response = await fetch(
      `${restProtocol}://${restHost}:${restPort}/api/prover/step6/${step2Answer.walletId}`, {
        method: 'POST',
        body: JSON.stringify(step6Body),
        headers: {
          'Content-Type': 'application/json'
        }
      }
    )
    step6Answer = await response.json()
    console.log("prover step6 answer: ", step6Answer)
  }

  async function verifierStep7() {
    const response = await fetch(
      `${restProtocol}://${restHost}:${restPort}/api/verifier/step7/${step2Answer.walletId}`
    )
    step7Answer = await response.json()
    console.log("issuer step7 answer: ", step7Answer)
  }

</script>
</head>
<body>
<h1>Negotiate Proof</h1>
<button id="issuerStep1" onclick="issuerStep1()">Issuer: Step1</button>
</br><button id="proverStep2" onclick="proverStep2()">Prover: Step2</button>
</br><button id="issuerStep3" onclick="issuerStep3()">Issuer: Step3</button>
</br><button id="proverStep4" onclick="proverStep4()">Prover: Step4</button>
</br><button id="issuerStep5" onclick="issuerStep5()">Issuer: Step5</button>
</br><button id="proverStep6" onclick="proverStep6()">Prover: Step6</button>
</br><button id="verifierStep7" onclick="verifierStep7()">Verifier: Step7</button>
</body>
</html>