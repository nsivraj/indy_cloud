<html>
<head>
<title>Digital Identifiers</title>
<script>
  //document.getElementById('issuerStep1').addEventListener('click', issuerStep1);
  var restProtocol = 'http';
  var restHost = 'localhost';
  var restPort = 9000;
  var agentData = {
    masterSecretId: '6265b3f9-ca0d-454c-b03d-dbad0a314dc8'
  };

  async function credentialApi(action) {

    let actionMethod = 'GET'
    let actionUri = 'api/'
    let actionBody = ''

    if(action === 'createTrusteeWallet') {
      actionMethod = 'GET'
      actionUri = actionUri + 'trustee/createWallet/0'
    } else if(action === 'createAuthorWallet') {
      actionMethod = 'GET'
      actionUri = actionUri + 'author/createWallet/0'
    } else if(action === 'createEndorserWallet') {
      actionMethod = 'GET'
      actionUri = actionUri + 'endorser/createWallet/0'
    } else if(action === 'createProverWallet') {
      actionMethod = 'GET'
      actionUri = actionUri + 'prover/createWallet/0'
    } else if(action === 'addAuthor') {
      actionMethod = 'POST'
      actionUri = actionUri + 'trustee/addAuthor/0'
      actionBody = JSON.stringify({
        trusteeDid: agentData.trusteeDid,
        authorDid: agentData.authorDid,
        authorVerkey: agentData.authorVerkey
      })
    } else if(action === 'addEndorser') {
      actionMethod = 'POST'
      actionUri = actionUri + 'trustee/addEndorser/0'
      actionBody = JSON.stringify({
        trusteeDid: agentData.trusteeDid,
        endorserDid: agentData.endorserDid,
        endorserVerkey: agentData.endorserVerkey
      })
    } else if(action === 'createSchema') {
      actionMethod = 'POST'
      actionUri = actionUri + 'author/createSchema/0'
      actionBody = JSON.stringify({
        endorserDid: agentData.endorserDid,
        authorDid: agentData.authorDid
      })
    } else if(action === 'signAndSubmitRequest') {
      actionMethod = 'POST'
      actionUri = actionUri + 'endorser/signAndSubmitRequest/0'
      actionBody = JSON.stringify({
        endorserDid: agentData.endorserDid,
        requestSignedByAuthor: agentData.signedSchemaRequest
      })
    } else if(action === 'createCredDef') {
      actionMethod = 'POST'
      actionUri = actionUri + 'author/createCredDef/0'
      actionBody = JSON.stringify({
        schemaJson: agentData.schemaJson,
        authorDid: agentData.authorDid
      })
    } else if(action === 'createMasterSecret') {
      actionMethod = 'POST'
      actionUri = actionUri + 'prover/createMasterSecret/0'
      actionBody = JSON.stringify({
        masterSecretId: agentData.masterSecretId
      })
    } else if(action === 'createCredOffer') {
      actionMethod = 'POST'
      actionUri = actionUri + 'author/createCredOffer/0'
      actionBody = JSON.stringify({
        credDefId: agentData.credDefId
      })
    } else if(action === 'createCredRequest') {
      actionMethod = 'POST'
      actionUri = actionUri + 'prover/createCredRequest/0'
      actionBody = JSON.stringify({
        credOffer: agentData.credOffer,
        credDefJson: agentData.credDefJson,
        proverDid: agentData.proverDid
      })
    } else if(action === 'createCredential') {
      actionMethod = 'POST'
      actionUri = actionUri + 'author/createCredential/0'
      actionBody = JSON.stringify({
        credOffer: agentData.credOffer,
        credReqJson: agentData.credReqJson
      })
    } else if(action === 'saveCredential') {
      actionMethod = 'POST'
      actionUri = actionUri + 'prover/saveCredential/0'
      actionBody = JSON.stringify({
        credential: agentData.credential,
        credDefJson: agentData.credDefJson,
        credReqMetadataJson: agentData.credReqMetadataJson
      })
    } else if(action === 'createProofRequest') {
      actionMethod = 'GET'
      actionUri = actionUri + 'verifier/createProofRequest/0'
    } else if(action === 'createProof') {
      actionMethod = 'POST'
      actionUri = actionUri + 'prover/createProof/0'
      actionBody = JSON.stringify({
        proofReqJson: agentData.proofRequestJson,
        credDefJson: agentData.credDefJson,
        schemaId: agentData.schemaId,
        schemaJson: agentData.schemaJson,
        credDefId: agentData.credDefId
      })
    } else if(action === 'verifyProof') {
      actionMethod = 'POST'
      actionUri = actionUri + 'verifier/verifyProof/0'
      actionBody = JSON.stringify({
        proofJson: agentData.proofJson,
        proofRequestJson: agentData.proofRequestJson,
        schemas: agentData.schemas,
        credentialDefs: agentData.credentialDefs
      })
    }

    const fetchOptions = {
      method: actionMethod,
      headers: {
        'Content-Type': 'application/json'
      }
    }
    if(actionMethod === 'POST') {
        fetchOptions.body = actionBody
    }

    const response = await fetch(
      `${restProtocol}://${restHost}:${restPort}/${actionUri}`,
      fetchOptions
    )
    const answer = await response.json()
    console.log(action + " answer: ", answer)

    if(action === 'createTrusteeWallet') {
      agentData.trusteeDid = answer.trusteeDid
    } else if(action === 'createAuthorWallet') {
      agentData.authorDid = answer.authorDid
      agentData.authorVerkey = answer.authorVerkey
    } else if(action === 'createEndorserWallet') {
      agentData.endorserDid = answer.endorserDid
      agentData.endorserVerkey = answer.endorserVerkey
    } else if(action === 'createProverWallet') {
      agentData.proverDid = answer.proverDid
      agentData.proverVerkey = answer.proverVerkey
    } else if(action === 'addAuthor') {

    } else if(action === 'addEndorser') {

    } else if(action === 'createSchema') {
      agentData.signedSchemaRequest = answer.signedSchemaRequest
      agentData.schemaJson = answer.schemaJson
      agentData.schemaId = answer.schemaId
    } else if(action === 'createCredDef') {
      agentData.credDefId = answer.credDefId
      agentData.credDefJson = answer.credDefJson
    } else if(action === 'createCredOffer') {
      agentData.credOffer = answer.credOffer
    } else if(action === 'createCredRequest') {
      agentData.credReqMetadataJson = answer.credReqMetadataJson
      agentData.credReqJson = answer.credReqJson
    } else if(action === 'createCredential') {
      agentData.credential = answer.credential
    } else if(action === 'saveCredential') {

    } else if(action === 'createProofRequest') {
      agentData.proofRequestJson = answer.proofRequestJson
    } else if(action === 'createProof') {
      agentData.proofJson = answer.proofJson
      agentData.schemas = answer.schemas
      agentData.credentialDefs = answer.credentialDefs
    } else if(action === 'verifyProof') {
      agentData.proved = answer.proved
    }
  }


</script>
</head>
<body>
<h1>Power Of Digital Credentials</h1>
<button id="createTrusteeWallet" onclick="credentialApi('createTrusteeWallet')">Trustee: Step1 -- createTrusteeWallet</button>
</br><button id="createAuthorWallet" onclick="credentialApi('createAuthorWallet')">Author: Step2 -- createAuthorWallet</button>
</br><button id="createEndorserWallet" onclick="credentialApi('createEndorserWallet')">Endorser: Step3 -- createEndorserWallet</button>
</br><button id="createProverWallet" onclick="credentialApi('createProverWallet')">Prover: Step4 -- createProverWallet</button>
</br><button id="addAuthor" onclick="credentialApi('addAuthor')">Trustee: Step5 -- addAuthor</button>
</br><button id="addEndorser" onclick="credentialApi('addEndorser')">Trustee: Step6 -- addEndorser</button>
</br><button id="createSchema" onclick="credentialApi('createSchema')">Author: Step7 -- createSchema</button>
</br><button id="signAndSubmitRequest" onclick="credentialApi('signAndSubmitRequest')">Endorser: Step8 -- signAndSubmitRequest</button>
</br><button id="createCredDef" onclick="credentialApi('createCredDef')">Author: Step9 -- createCredDef</button>
</br><button id="createMasterSecret" onclick="credentialApi('createMasterSecret')">Prover: Step10 -- createMasterSecret</button>
</br><button id="createCredOffer" onclick="credentialApi('createCredOffer')">Author: Step11 -- createCredOffer</button>
</br><button id="createCredRequest" onclick="credentialApi('createCredRequest')">Prover: Step12 -- createCredRequest</button>
</br><button id="createCredential" onclick="credentialApi('createCredential')">Author: Step13 -- createCredential</button>
</br><button id="saveCredential" onclick="credentialApi('saveCredential')">Prover: Step14 -- saveCredential</button>
</br><button id="createProofRequest" onclick="credentialApi('createProofRequest')">Verifier: Step15 -- createProofRequest</button>
</br><button id="createProof" onclick="credentialApi('createProof')">Prover: Step16 -- createProof</button>
</br><button id="verifyProof" onclick="credentialApi('verifyProof')">Verifier: Step17 -- verifyProof</button>

</body>
</html>